<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: GraphQL::InternalRepresentation::Rewrite
  
    &mdash; GraphQL Ruby API Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "GraphQL::InternalRepresentation::Rewrite";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../InternalRepresentation.html" title="GraphQL::InternalRepresentation (module)">InternalRepresentation</a></span></span>
     &raquo; 
    <span class="title">Rewrite</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: GraphQL::InternalRepresentation::Rewrite
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">GraphQL::InternalRepresentation::Rewrite</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../Language.html" title="GraphQL::Language (module)">Language</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/graphql/internal_representation/rewrite.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>While visiting an AST, build a normalized, flattened tree of <span class='object_link'><a href="Node.html" title="GraphQL::InternalRepresentation::Node (class)">Node</a></span>s.</p>

<p>No unions or interfaces are present in this tree, only object types.</p>

<p>Selections from the AST are attached to the object types they apply to.</p>

<p>Inline fragments and fragment spreads are preserved in InternalRepresentation::Node#ast_spreads,
where they can be used to check for the presence of directives. This might not be sufficient
for future directives, since the selectionsâ€™ grouping is lost.</p>

<p>The rewritten query tree serves as the basis for the <code>FieldsWillMerge</code> validation.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Rewrite/VisitDefinition.html" title="GraphQL::InternalRepresentation::Rewrite::VisitDefinition (class)">VisitDefinition</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="NO_DIRECTIVES-constant" class="">NO_DIRECTIVES =
        
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
    
  </dl>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#document-instance_method" title="#document (instance method)">#<strong>document</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>InternalRepresentation::Document.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; Rewrite </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of Rewrite.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#operations-instance_method" title="#operations (instance method)">#<strong>operations</strong>  &#x21d2; Hash&lt;String, Node&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Roots of this query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip%3F-instance_method" title="#skip? (instance method)">#<strong>skip?</strong>(ast_node, query)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">#<strong>validate</strong>(context)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Language.html" title="GraphQL::Language (module)">Language</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Language.html#serialize-class_method" title="GraphQL::Language.serialize (method)">serialize</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="GraphQL::InternalRepresentation::Rewrite (class)">Rewrite</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of Rewrite</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/internal_representation/rewrite.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@document</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../InternalRepresentation.html" title="GraphQL::InternalRepresentation (module)">InternalRepresentation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Document.html" title="GraphQL::InternalRepresentation::Document (class)">Document</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Document.html#initialize-instance_method" title="GraphQL::InternalRepresentation::Document#initialize (method)">new</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="document-instance_method">
  
    #<strong>document</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns InternalRepresentation::Document</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>InternalRepresentation::Document</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/internal_representation/rewrite.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_document'>document</span>
  <span class='ivar'>@document</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="operations-instance_method">
  
    #<strong>operations</strong>  &#x21d2; <tt>Hash&lt;String, <span class='object_link'><a href="Node.html" title="GraphQL::InternalRepresentation::Node (class)">Node</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns Roots of this query</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;String, <span class='object_link'><a href="Node.html" title="GraphQL::InternalRepresentation::Node (class)">Node</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Roots of this query</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/internal_representation/rewrite.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_operations'>operations</span>
  <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>#operations is deprecated; use `document.operation_definitions` instead</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_operation_definitions'>operation_definitions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="skip?-instance_method">
  
    #<strong>skip?</strong>(ast_node, query)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/internal_representation/rewrite.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_ast_node'>ast_node</span><span class='period'>.</span><span class='id identifier rubyid_directives'>directives</span>
  <span class='id identifier rubyid_dir'>dir</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Execution.html" title="GraphQL::Execution (module)">Execution</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Execution/DirectiveChecks.html" title="GraphQL::Execution::DirectiveChecks (module)">DirectiveChecks</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Execution/DirectiveChecks.html#include%3F-class_method" title="GraphQL::Execution::DirectiveChecks.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    #<strong>validate</strong>(context)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/internal_representation/rewrite.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_visitor'>visitor</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_visitor'>visitor</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span>
  <span class='comment'># Hash&lt;Nodes::FragmentSpread =&gt; Set&lt;InternalRepresentation::Node&gt;&gt;
</span>  <span class='comment'># A record of fragment spreads and the irep nodes that used them
</span>  <span class='id identifier rubyid_spread_parents'>spread_parents</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
  <span class='comment'># Hash&lt;Nodes::FragmentSpread =&gt; Scope&gt;
</span>  <span class='id identifier rubyid_spread_scopes'>spread_scopes</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'># Array&lt;Set&lt;InternalRepresentation::Node&gt;&gt;
</span>  <span class='comment'># The current point of the irep_tree during visitation
</span>  <span class='id identifier rubyid_nodes_stack'>nodes_stack</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='comment'># Array&lt;Scope&gt;
</span>  <span class='id identifier rubyid_scopes_stack'>scopes_stack</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_skip_nodes'>skip_nodes</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_visit_op'>visit_op</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Rewrite/VisitDefinition.html" title="GraphQL::InternalRepresentation::Rewrite::VisitDefinition (class)">VisitDefinition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Rewrite/VisitDefinition.html#initialize-instance_method" title="GraphQL::InternalRepresentation::Rewrite::VisitDefinition#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_context'>context</span><span class='comma'>,</span> <span class='ivar'>@document</span><span class='period'>.</span><span class='id identifier rubyid_operation_definitions'>operation_definitions</span><span class='comma'>,</span> <span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='comma'>,</span> <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/OperationDefinition.html" title="GraphQL::Language::Nodes::OperationDefinition (class)">OperationDefinition</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_visit_op'>visit_op</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:enter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/OperationDefinition.html" title="GraphQL::Language::Nodes::OperationDefinition (class)">OperationDefinition</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_leave'>leave</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_visit_op'>visit_op</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:leave</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_visit_frag'>visit_frag</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Rewrite/VisitDefinition.html" title="GraphQL::InternalRepresentation::Rewrite::VisitDefinition (class)">VisitDefinition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Rewrite/VisitDefinition.html#initialize-instance_method" title="GraphQL::InternalRepresentation::Rewrite::VisitDefinition#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_context'>context</span><span class='comma'>,</span> <span class='ivar'>@document</span><span class='period'>.</span><span class='id identifier rubyid_fragment_definitions'>fragment_definitions</span><span class='comma'>,</span> <span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='comma'>,</span> <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/FragmentDefinition.html" title="GraphQL::Language::Nodes::FragmentDefinition (class)">FragmentDefinition</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_visit_frag'>visit_frag</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:enter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/FragmentDefinition.html" title="GraphQL::Language::Nodes::FragmentDefinition (class)">FragmentDefinition</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_leave'>leave</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_visit_frag'>visit_frag</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:leave</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/InlineFragment.html" title="GraphQL::Language::Nodes::InlineFragment (class)">InlineFragment</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span> <span class='op'>&lt;&lt;</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_ast_parent'>ast_parent</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
    <span class='comment'># Inline fragments provide two things to the rewritten tree:
</span>    <span class='comment'># - They _may_ narrow the scope by their type condition
</span>    <span class='comment'># - They _may_ apply their directives to their children
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span>
      <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span><span class='lparen'>(</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_type_definition'>type_definition</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/InlineFragment.html" title="GraphQL::Language::Nodes::InlineFragment (class)">InlineFragment</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_leave'>leave</span> <span class='op'>&lt;&lt;</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_ast_parent'>ast_parent</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span>
      <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/Field.html" title="GraphQL::Language::Nodes::Field (class)">Field</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span> <span class='op'>&lt;&lt;</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_ast_parent'>ast_parent</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span>
      <span class='id identifier rubyid_node_name'>node_name</span> <span class='op'>=</span> <span class='id identifier rubyid_ast_node'>ast_node</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span> <span class='op'>||</span> <span class='id identifier rubyid_ast_node'>ast_node</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
      <span class='id identifier rubyid_parent_nodes'>parent_nodes</span> <span class='op'>=</span> <span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='id identifier rubyid_next_nodes'>next_nodes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_field_defn'>field_defn</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_field_definition'>field_definition</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_field_defn'>field_defn</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='comment'># It&#39;s a non-existent field
</span>        <span class='id identifier rubyid_new_scope'>new_scope</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_field_return_type'>field_return_type</span> <span class='op'>=</span> <span class='id identifier rubyid_field_defn'>field_defn</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
        <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_scope_type'>scope_type</span><span class='op'>|</span>
          <span class='id identifier rubyid_parent_nodes'>parent_nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent_node'>parent_node</span><span class='op'>|</span>
            <span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_node'>parent_node</span><span class='period'>.</span><span class='id identifier rubyid_scoped_children'>scoped_children</span><span class='lbracket'>[</span><span class='id identifier rubyid_scope_type'>scope_type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="Node.html" title="GraphQL::InternalRepresentation::Node (class)">Node</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Node.html#initialize-instance_method" title="GraphQL::InternalRepresentation::Node#initialize (method)">new</a></span></span><span class='lparen'>(</span>
              <span class='label'>parent:</span> <span class='id identifier rubyid_parent_node'>parent_node</span><span class='comma'>,</span>
              <span class='label'>name:</span> <span class='id identifier rubyid_node_name'>node_name</span><span class='comma'>,</span>
              <span class='label'>owner_type:</span> <span class='id identifier rubyid_scope_type'>scope_type</span><span class='comma'>,</span>
              <span class='label'>query:</span> <span class='id identifier rubyid_query'>query</span><span class='comma'>,</span>
              <span class='label'>return_type:</span> <span class='id identifier rubyid_field_return_type'>field_return_type</span><span class='comma'>,</span>
            <span class='rparen'>)</span>
            <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_ast_nodes'>ast_nodes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ast_node'>ast_node</span>
            <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_definitions'>definitions</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_field_defn'>field_defn</span>
            <span class='id identifier rubyid_next_nodes'>next_nodes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_node'>node</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_new_scope'>new_scope</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Scope.html" title="GraphQL::InternalRepresentation::Scope (class)">Scope</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Scope.html#initialize-instance_method" title="GraphQL::InternalRepresentation::Scope#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_field_return_type'>field_return_type</span><span class='period'>.</span><span class='id identifier rubyid_unwrap'>unwrap</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_next_nodes'>next_nodes</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_new_scope'>new_scope</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/Field.html" title="GraphQL::Language::Nodes::Field (class)">Field</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_leave'>leave</span> <span class='op'>&lt;&lt;</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_ast_parent'>ast_parent</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span>
      <span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
      <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_visitor'>visitor</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Language/Nodes.html" title="GraphQL::Language::Nodes (module)">Nodes</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Language/Nodes/FragmentSpread.html" title="GraphQL::Language::Nodes::FragmentSpread (class)">FragmentSpread</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_enter'>enter</span> <span class='op'>&lt;&lt;</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_ast_parent'>ast_parent</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_skip_nodes'>skip_nodes</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
      <span class='comment'># Register the irep nodes that depend on this AST node:
</span>      <span class='id identifier rubyid_spread_parents'>spread_parents</span><span class='lbracket'>[</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_nodes_stack'>nodes_stack</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_spread_scopes'>spread_scopes</span><span class='lbracket'>[</span><span class='id identifier rubyid_ast_node'>ast_node</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_scopes_stack'>scopes_stack</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='comment'># Resolve fragment spreads.
</span>  <span class='comment'># Fragment definitions got their own irep trees during visitation.
</span>  <span class='comment'># Those nodes are spliced in verbatim (not copied), but this is OK
</span>  <span class='comment'># because fragments are resolved from the &quot;bottom up&quot;, each fragment
</span>  <span class='comment'># can be shared between its usages.
</span>  <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_on_dependency_resolve'>on_dependency_resolve</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_defn_ast_node'>defn_ast_node</span><span class='comma'>,</span> <span class='id identifier rubyid_spread_ast_nodes'>spread_ast_nodes</span><span class='comma'>,</span> <span class='id identifier rubyid_frag_ast_node'>frag_ast_node</span><span class='op'>|</span>
    <span class='id identifier rubyid_frag_name'>frag_name</span> <span class='op'>=</span> <span class='id identifier rubyid_frag_ast_node'>frag_ast_node</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_fragment_node'>fragment_node</span> <span class='op'>=</span> <span class='ivar'>@document</span><span class='period'>.</span><span class='id identifier rubyid_fragment_definitions'>fragment_definitions</span><span class='lbracket'>[</span><span class='id identifier rubyid_frag_name'>frag_name</span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_fragment_node'>fragment_node</span>
      <span class='id identifier rubyid_spread_ast_nodes'>spread_ast_nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_spread_ast_node'>spread_ast_node</span><span class='op'>|</span>
        <span class='id identifier rubyid_parent_nodes'>parent_nodes</span> <span class='op'>=</span> <span class='id identifier rubyid_spread_parents'>spread_parents</span><span class='lbracket'>[</span><span class='id identifier rubyid_spread_ast_node'>spread_ast_node</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_parent_scope'>parent_scope</span> <span class='op'>=</span> <span class='id identifier rubyid_spread_scopes'>spread_scopes</span><span class='lbracket'>[</span><span class='id identifier rubyid_spread_ast_node'>spread_ast_node</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_parent_nodes'>parent_nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent_node'>parent_node</span><span class='op'>|</span>
          <span class='id identifier rubyid_parent_node'>parent_node</span><span class='period'>.</span><span class='id identifier rubyid_deep_merge_node'>deep_merge_node</span><span class='lparen'>(</span><span class='id identifier rubyid_fragment_node'>fragment_node</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='id identifier rubyid_parent_scope'>parent_scope</span><span class='comma'>,</span> <span class='label'>merge_self:</span> <span class='kw'>false</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri May 18 14:04:02 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>