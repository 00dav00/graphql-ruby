<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Testing</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/1.8.7/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <p class="breadcrumb">
  <a href="/">GraphQL</a>
  &raquo; <a href="/guides">Guides</a>
   &raquo; <a href="/guides#schema-guides">Schema</a>
  &raquo; Testing
</p>



<h1 class="guide-header">Testing</h1>
<div class="guide-container">
  <p>There are a few ways to test the behavior of your GraphQL schema:</p>

<ul>
  <li><em>Don’t</em> test the schema, test other objects instead</li>
  <li>Execute GraphQL queries and test the result</li>
</ul>

<h2 id="dont-test-the-schema">Don’t test the schema</h2>

<p>The easiest way to test behavior of a GraphQL schema is to extract behavior into separate objects and test those objects in isolation. For Rails, you don’t test your models by running controller tests, right? Similarly, you can test “lower-level” parts of the system on their own without running end-to-end tests.</p>

<p>For example, consider a field which calculates its own value:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PostType</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">Object</span>
  <span class="c1"># ...</span>
  <span class="n">field</span> <span class="ss">:is_trending</span><span class="p">,</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>

  <span class="k">def</span> <span class="nf">is_trending</span>
    <span class="n">recent_comments</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"created_at &lt; ?"</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">ago</span><span class="p">)</span>
    <span class="n">recent_comments</span><span class="p">.</span><span class="nf">count</span> <span class="o">&gt;</span> <span class="mi">100</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can refactor this by creating a new class and applying it to your GraphQL schema:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/post/trending.rb</span>
<span class="k">class</span> <span class="nc">Post</span>
  <span class="k">class</span> <span class="nc">Trending</span>
    <span class="no">TRENDING_COMMENTS_COUNT</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
      <span class="vi">@post</span> <span class="o">=</span> <span class="n">post</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">value</span>
      <span class="n">recent_comments</span> <span class="o">=</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"created_at &lt; ?"</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">ago</span><span class="p">)</span>
      <span class="n">recent_comments</span><span class="p">.</span><span class="nf">count</span> <span class="o">&gt;</span> <span class="no">TRENDING_COMMENTS_COUNT</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># ....</span>

<span class="k">class</span> <span class="nc">PostType</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">Object</span>
  <span class="c1"># ...</span>
  <span class="n">field</span> <span class="ss">:is_trending</span><span class="p">,</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>

  <span class="k">def</span> <span class="nf">is_trending</span>
    <span class="no">Post</span><span class="o">::</span><span class="no">Trending</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">object</span><span class="p">).</span><span class="nf">value</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is an improvement because your behavior is not coupled to your GraphQL schema. Besides that, it’s easier to test: you can simply unit test the calculation class. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># spec/models/post/trending_spec.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Post</span><span class="o">::</span><span class="no">Trending</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:trending</span><span class="p">)</span> <span class="p">{</span> <span class="no">Post</span><span class="o">::</span><span class="no">Trending</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"#value"</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s2">"when there are no recent comments"</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s2">"is false"</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">trending</span><span class="p">.</span><span class="nf">value</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s2">"when there are more than 100 recent comments"</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="mi">101</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:comment</span><span class="p">,</span> <span class="ss">post: </span><span class="n">post</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">"is true"</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">trending</span><span class="p">.</span><span class="nf">value</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="executing-graphql-queries">Executing GraphQL queries</h2>

<p>Sometimes, you really need an end-to-end test. Although it requires a lot of overhead, it’s nice to have a “sanity check” on the system as a whole (for example, authorization and database batching).</p>

<p>You can execute queries on your schema in a test. For example, you can set it up like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">MySchema</span> <span class="k">do</span>
  <span class="c1"># You can override `context` or `variables` in</span>
  <span class="c1"># more specific scopes</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="p">{</span> <span class="p">{}</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:variables</span><span class="p">)</span> <span class="p">{</span> <span class="p">{}</span> <span class="p">}</span>
  <span class="c1"># Call `result` to execute the query</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:result</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
      <span class="n">query_string</span><span class="p">,</span>
      <span class="ss">context: </span><span class="n">context</span><span class="p">,</span>
      <span class="ss">variables: </span><span class="n">variables</span>
    <span class="p">)</span>
    <span class="c1"># Print any errors</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s2">"errors"</span><span class="p">]</span>
      <span class="n">pp</span> <span class="n">res</span>
    <span class="k">end</span>
    <span class="n">res</span>
  <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"a specific query"</span> <span class="k">do</span>
    <span class="c1"># provide a query string for `result`</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:query_string</span><span class="p">)</span> <span class="p">{</span> <span class="sx">%|{ viewer { name } }|</span> <span class="p">}</span>

    <span class="n">context</span> <span class="s2">"when there's no current user"</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s2">"is nil"</span> <span class="k">do</span>
        <span class="c1"># calling `result` executes the query</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">][</span><span class="s2">"viewer"</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s2">"when there's a current user"</span> <span class="k">do</span>
      <span class="c1"># override `context`</span>
      <span class="n">let</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">{</span> <span class="ss">current_user: </span><span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"ABC"</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">it</span> <span class="s2">"shows the user's name"</span> <span class="k">do</span>
        <span class="n">user_name</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"data"</span><span class="p">][</span><span class="s2">"viewer"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">user_name</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"ABC"</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/schema/testing.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Testing">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
