<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GraphQL Ruby - Schema — Testing</title>
    <link rel="stylesheet" href="/graphql-ruby/css/main.css">
    <link rel="icon" href="/graphql-ruby/graphql-ruby-icon.png">
    <meta name="generator">
  </head>
  <body class="hack">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-19264608-11', 'auto');
      ga('send', 'pageview');
    </script>
    <div class="container">
      <div style="display: flex; justify-content: center;">
<strong style="white-space: pre; line-height: 1.1em; display: inline-block; font-size: 8px;">
    ▄██████▄     ▄████████    ▄████████    ▄███████▄    ▄█    █▄    ████████▄    ▄█
   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███  ███
   ███    █▀    ███    ███   ███    ███   ███    ███   ███    ███   ███    ███  ███
  ▄███         ▄███▄▄▄▄██▀   ███    ███   ███    ███  ▄███▄▄▄▄███▄▄ ███    ███  ███
 ▀▀███ ████▄  ▀▀███▀▀▀▀▀   ▀███████████ ▀█████████▀  ▀▀███▀▀▀▀███▀  ███    ███  ███
   ███    ███ ▀███████████   ███    ███   ███          ███    ███   ███    ███  ███
   ███    ███   ███    ███   ███    ███   ███          ███    ███   ███  ▀ ███  ███▌    ▄
   ████████▀    ███    ███   ███    █▀   ▄████▀        ███    █▀     ▀██████▀▄█ █████▄▄██
                ███    ███                                                      ▀
</strong>
      </div>
      <p style="text-align: center;">A GraphQL server implementation for Ruby</p>

      <div class="grid -between">
        <div class="cell -3of12">
          <h3>Guides</h3>
          <ul>
            <li><a href="/graphql-ruby/">Getting Started</a></li>
            <li>
              <strong>Schema</strong>
              <ul>
                <li><a href="/graphql-ruby/schema/types_and_fields">Types and Fields</a></li>
                <li><a href="/graphql-ruby/schema/configuration_options">Configuration Options</a></li>
                <li><a href="/graphql-ruby/schema/code_reuse">Code Reuse</a></li>
                <li><a href="/graphql-ruby/schema/instrumentation">Instrumentation</a></li>
                <li><a href="/graphql-ruby/schema/lazy_execution">Lazy Execution</a></li>
                <li><a href="/graphql-ruby/schema/limiting_visibility">Limiting Visibility</a></li>
                <li><a href="/graphql-ruby/schema/testing">Testing</a></li>
              </ul>
            </li>
            <li>
              <strong>Queries</strong>
              <ul>
                <li><a href="/graphql-ruby/queries/executing_queries">Executing Queries</a></li>
                <li><a href="/graphql-ruby/queries/authorization">Authorization</a></li>
                <li><a href="/graphql-ruby/queries/security">Security</a></li>
                <li><a href="/graphql-ruby/queries/error_handling">Error Handling</a></li>
                <li><a href="/graphql-ruby/queries/phases_of_execution">Phases of Execution</a></li>
              </ul>
            </li>
            <li>
              <strong>Relay</strong>
              <ul>
                <li><a href="/graphql-ruby/relay/object_identification">Object Identification</a></li>
                <li><a href="/graphql-ruby/relay/connections">Connections</a></li>
                <li><a href="/graphql-ruby/relay/mutations">Mutations</a></li>
              </ul>
            </li>
            <li>
              <strong>GraphQL::Pro</strong>
              <ul>
                <li><a href="http://graphql.pro">GraphQL::Pro Home</a></li>
                <li><a href="/graphql-ruby/pro/installation">Installation & Updates</a></li>
                <li><a href="/graphql-ruby/pro/authorization">Authorization</a></li>
                <li><a href="/graphql-ruby/pro/monitoring">Monitoring</a></li>
                <li><a href="/graphql-ruby/pro/cursors">Stable Cursors<br/>for ActiveRecord</a></li>
                <li><a href="/graphql-ruby/pro/encoders">Encrypted, Versioned<br/>Cursors and Ids</a></li>
              </ul>
            </li>
            <li><a href="/graphql-ruby/related_projects">Related Projects</a></li>
          </ul>
          <h3><a href="https://tinyletter.com/graphql-ruby">GraphQL Ruby Newsletter</a></h3>
          <h3><a href="http://www.rubydoc.info/github/rmosolgo/graphql-ruby">API Docs</a></h3>
          <h3><a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a></h3>
        </div>
        <div class="cell -9of12">
          <h1 class="guide-header">Schema — Testing</h1>
          <p>There are a few ways to test the behavior of your GraphQL schema:</p>

<ul>
  <li><em>Don’t</em> test the schema, test other objects instead</li>
  <li>Test schema elements (types, fields) in isolation</li>
  <li>Execute GraphQL queries and test the result</li>
</ul>

<h2 id="dont-test-the-schema">Don’t test the schema</h2>

<p>The easiest way to test behavior of a GraphQL schema is to extract behavior into separate objects and test those objects in isolation. For Rails, you don’t test your models by running controller tests, right? Similarly, you can test “lower-level” parts of the system on their own without running end-to-end tests.</p>

<p>For example, consider a field which calculates its own value:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">PostType</span> = <span style="color:#036;font-weight:bold">GraphQL</span>::<span style="color:#036;font-weight:bold">ObjectType</span>.define <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#777"># ...</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  field <span style="color:#A60">:isTrending</span>, types.Boolean <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>    resolve -&gt;(obj, args, ctx) {
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>      recent_comments = comments.where(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">created_at &lt; ?</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>.day.ago)
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>      recent_comments.count &gt; <span style="color:#00D">100</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    }
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>You can refactor this by creating a new class and applying it to your GraphQL schema:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#777"># app/models/post/trending.rb</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Post</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Trending</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>    <span style="color:#036;font-weight:bold">TRENDING_COMMENTS_COUNT</span> = <span style="color:#00D">100</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(post)
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>      <span style="color:#33B">@post</span> = post
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">value</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>      recent_comments = <span style="color:#33B">@post</span>.comments.where(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">created_at &lt; ?</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>.day.ago)
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>      recent_comments.count &gt; <span style="color:#036;font-weight:bold">TRENDING_COMMENTS_COUNT</span>       
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span><span style="color:#777"># ....</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span><span style="color:#036;font-weight:bold">PostType</span> = <span style="color:#036;font-weight:bold">GraphQL</span>::<span style="color:#036;font-weight:bold">ObjectType</span>.define <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>  <span style="color:#777"># ...</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>  field <span style="color:#A60">:isTrending</span>, types.Boolean <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>    resolve -&gt;(obj, args, ctx) {
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>      <span style="color:#777"># Use the Post::Trending class to calculate the value</span>
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>      <span style="color:#036;font-weight:bold">Post</span>::<span style="color:#036;font-weight:bold">Trending</span>.new(obj).value
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>    }
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n26" name="n26">26</a></span><span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>This is an improvement because your behavior is not coupled to your GraphQL schema. Besides that, it’s easier to test: you can simply unit test the calculation class. For example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#777"># app/models/post/trending_spec.rb</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>describe <span style="color:#036;font-weight:bold">Post</span>::<span style="color:#036;font-weight:bold">Trending</span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  let(<span style="color:#A60">:post</span>) { create(<span style="color:#A60">:post</span>) }
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  let(<span style="color:#A60">:trending</span>) { <span style="color:#036;font-weight:bold">Post</span>::<span style="color:#036;font-weight:bold">Trending</span>.new(post) }
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>  describe <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#value</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    context <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">when there are no recent comments</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>      it <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">is false</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>        expect(trending.value).to eq(<span style="color:#069">false</span>)
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>      <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>    context <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">when there are more than 100 recent comments</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>      before <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>        <span style="color:#00D">101</span>.times { create(<span style="color:#A60">:comment</span>, <span style="color:#606">post</span>: post) }
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>      <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>      it <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">is true</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>        expect(trending.value).to eq(<span style="color:#069">true</span>)
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>      <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n23" name="n23">23</a></span><span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<h2 id="testing-schema-elements-in-isolation">Testing schema elements in isolation</h2>

<p>You can access type and field objects from your schema to make sure they’re defined correctly and behave the way you expect them to.</p>

<h4 id="types">Types</h4>

<p>Access a type by name from the schema with <code>GraphQL::Schema#types</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>post = <span style="color:#036;font-weight:bold">MySchema</span>.types[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Post</span><span style="color:#710">&quot;</span></span>] <span style="color:#777"># =&gt; PostType</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>post.fields                   <span style="color:#777"># =&gt; {&quot;id&quot; =&gt; &lt;GraphQL::Field&gt;, ... }</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>post.fields.keys              <span style="color:#777"># =&gt; [&quot;id&quot;, &quot;title&quot;, &quot;body&quot;, &quot;author&quot;, &quot;comments&quot;]</span>
</pre></div>
</div>
</div>

<p>The returned value of <code>Schema#types[type_name]</code> is an instance of the type class you used to <code>.define</code> it (eg, <code>GraphQL::ObjectType</code>, <code>GraphQL::EnumType</code>, <code>GraphQL::InputObjectType</code>).</p>

<h4 id="fields">Fields</h4>

<p>You can get a type’s fields from the <code>GraphQL::ObjectType#fields</code> hash. For example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>post_type = <span style="color:#036;font-weight:bold">MySchema</span>.types[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Post</span><span style="color:#710">&quot;</span></span>]
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>title_field = post_type.fields[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">title</span><span style="color:#710">&quot;</span></span>] <span style="color:#777">#=&gt; &lt;GraphQL::Field&gt;</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>title_field.name <span style="color:#777">#=&gt; &quot;title&quot;</span>
</pre></div>
</div>
</div>

<p>You can test a resolve function by calling <code>GraphQL::Field#resolve</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># Because this field doesn't use context or variables, simply pass `nil`</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>post = <span style="color:#036;font-weight:bold">Post</span>.new(<span style="color:#606">title</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Welcome to my blog</span><span style="color:#710">&quot;</span></span>)
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>name_field.resolve(post, <span style="color:#069">nil</span>, <span style="color:#069">nil</span>) <span style="color:#777">#=&gt; &quot;Welcome to my blog&quot;</span>
</pre></div>
</div>
</div>

<p>Calling <code>resolve</code> in this way does <em>not</em> apply any coercion. (That’s only applied during query execution.)</p>

<h4 id="other-elements">Other elements</h4>

<p>Similarly, you can access:</p>

<ul>
  <li><code>GraphQL::Field#arguments</code>, which are <code>String</code> =&gt; <code>GraphQL::Argument</code> pairs</li>
  <li><code>GraphQL::Field#type</code>, the field’s return type</li>
  <li><code>GraphQL::InputObjectType#arguments</code>, which are <code>String</code> =&gt; <code>GraphQL::Argument</code> pairs</li>
  <li><code>GraphQL::EnumType#values</code>, which are <code>String</code> =&gt; <code>GraphQL::EnumType::EnumValue</code> pairs</li>
  <li><code>GraphQL::Schema#possible_types(type_defn)</code>, which returns the possible types for union or interface types in a given schema</li>
</ul>

<p><code>GraphQL::BaseType#unwrap</code> may also be helpful. It returns the “inner-most” type. For example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>required_list_of_strings = <span style="color:#036;font-weight:bold">GraphQL</span>::<span style="color:#036;font-weight:bold">NonNullType</span>.new(
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>  <span style="color:#606">of_type</span>: <span style="color:#036;font-weight:bold">GraphQL</span>::<span style="color:#036;font-weight:bold">ListType</span>.new(
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>    <span style="color:#606">of_type</span>: <span style="color:#036;font-weight:bold">GraphQL</span>::<span style="color:#036;font-weight:bold">STRING_TYPE</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  )
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>)
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>required_list_of_strings.unwrap <span style="color:#777">#=&gt; GraphQL::STRING_TYPE</span>
</pre></div>
</div>
</div>

<h2 id="executing-graphql-queries">Executing GraphQL queries</h2>

<p>Sometimes, you really need an end-to-end test. Although it requires a lot of overhead, it’s nice to have a “sanity check” on the system as a whole.</p>

<p>You can execute queries on your schema in a test. For example, you can set it up like this:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>describe <span style="color:#036;font-weight:bold">MySchema</span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#777"># You can override `context` or `variables` in</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#777"># more specific scopes</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  let(<span style="color:#A60">:context</span>) { {} }
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>  let(<span style="color:#A60">:variables</span>) { {} }
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>  <span style="color:#777"># Call `result` to execute the query</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>  let(<span style="color:#A60">:result</span>) {
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    res = <span style="color:#036;font-weight:bold">MySchema</span>.execute(
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>      query_string,
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>      <span style="color:#606">context</span>: context,
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>      <span style="color:#606">variables</span>: variables
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    )
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>    <span style="color:#777"># Print any errors</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>    <span style="color:#080;font-weight:bold">if</span> res[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">errors</span><span style="color:#710">&quot;</span></span>]
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>      pp res
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>    res
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>  }
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>  describe <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a specific query</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>    <span style="color:#777"># provide a query string for `result`</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>    let(<span style="color:#A60">:query_string</span>) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">%|</span><span style="color:#D20">{ viewer { name } }</span><span style="color:#710">|</span></span> }
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>    context <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">when there's no current user</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>      it <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">is nil</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>        <span style="color:#777"># calling `result` executes the query</span>
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>        expect(result[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">data</span><span style="color:#710">&quot;</span></span>][<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">viewer</span><span style="color:#710">&quot;</span></span>]).to eq(<span style="color:#069">nil</span>)
<span class="line-numbers"><a href="#n28" name="n28">28</a></span>      <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n29" name="n29">29</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>
<span class="line-numbers"><a href="#n31" name="n31">31</a></span>    context <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">when there's a current user</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n32" name="n32">32</a></span>      <span style="color:#777"># override `context`</span>
<span class="line-numbers"><a href="#n33" name="n33">33</a></span>      let(<span style="color:#A60">:context</span>) {
<span class="line-numbers"><a href="#n34" name="n34">34</a></span>        { <span style="color:#606">current_user</span>: <span style="color:#036;font-weight:bold">User</span>.new(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ABC</span><span style="color:#710">&quot;</span></span>) }
<span class="line-numbers"><a href="#n35" name="n35">35</a></span>      }
<span class="line-numbers"><a href="#n36" name="n36">36</a></span>      it <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">shows the user's name</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span>
<span class="line-numbers"><a href="#n37" name="n37">37</a></span>        user_name = result[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">data</span><span style="color:#710">&quot;</span></span>][<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">viewer</span><span style="color:#710">&quot;</span></span>][<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span>]
<span class="line-numbers"><a href="#n38" name="n38">38</a></span>        expect(user_name).to eq(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ABC</span><span style="color:#710">&quot;</span></span>)
<span class="line-numbers"><a href="#n39" name="n39">39</a></span>      <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><strong><a href="#n40" name="n40">40</a></strong></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n41" name="n41">41</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n42" name="n42">42</a></span><span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

        </div>
      </div>
    </div>
    <script>
      // Find headers with IDs and wrap their text in `<a href=></a>`
      // That way people can easily copy the link.
      var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
      var header, idText, headerLink;
      for (var i = 0; i < headers.length; i++) {
        header = headers[i];
        idText = header.id;
        if (idText) {
          headerLink = document.createElement("a");
          headerLink.href = "#" + idText;
          headerLink.textContent = header.textContent;
          header.textContent = "";
          header.appendChild(headerLink);
        }
      }
    </script>
  </body>
</html>
